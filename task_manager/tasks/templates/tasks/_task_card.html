<div
    class="box mt-5 mb-1 kanban-task has-shadow transition-kanban kanban-task-hover kanban-task-card"
    :data-task-id="task.id"
    draggable="true"
    @dragstart="dragStart(task.id)"
    @dragend="dragEnd"
    :class="[
        dragging == task.id ? 'is-dragging' : '',
        'kanban-task-hover'
    ]"
>
    <div class="is-flex is-justify-content-space-between is-align-items-flex-start is-flex-direction-row is-flex-wrap-wrap is-relative">
        <a :href="`/tasks/${task.slug}`" class="is-flex-grow-1 kanban-task-link">
            <div class="is-flex is-align-items-center mb-2">
                <span class="avatar mr-2" :title="task.executor?.full_name">
                    <template x-if="task.executor?.avatar">
                        <img :src="task.executor.avatar" class="is-rounded kanban-task-avatar">
                    </template>
                    <template x-if="!task.executor?.avatar">
                        <span class="tag is-info is-light is-medium kanban-task-avatar-fallback">
                            <span x-text="task.executor?.full_name ? task.executor.full_name[0] : '?'" />
                        </span>
                    </template>
                </span>
                <span class="is-size-5 has-text-weight-bold task-title kanban-task-title"
                      :class="task.status == 'done' ? 'has-text-success' : 'has-text-link'"
                      x-text="task.name"></span>
            </div>
            <div class="mb-1 is-flex is-align-items-center is-flex-wrap-wrap kanban-task-badges">
                <span class="tag is-light is-small" title="Автор">
                    <i class="fas fa-user"></i> 
                    <span x-text="task.author?.full_name"></span>
                </span>
                <span class="tag is-primary is-light is-small" title="Исполнитель">
                    <i class="fas fa-user-check"></i> 
                    <span x-text="task.executor?.full_name"></span>
                </span>
                <span class="tag is-warning is-light is-small" title="Приоритет" x-show="task.priority">
                    <i class="fas fa-flag"></i> 
                    <span x-text="task.priority"></span>
                </span>
                <span class="tag is-info is-light is-small" title="Дедлайн" x-show="task.deadline">
                    <i class="fas fa-clock"></i> 
                    <span x-text="task.deadline"></span>
                </span>
            </div>
            <small class="has-text-grey">Создана: <i x-text="task.created_at"></i></small>
        </a>
        <div class="dropdown kanban-dropdown-fix" :class="{ 'is-active': dropdownTaskId === task.id }">
            <div class="dropdown-trigger">
                <button class="button is-white is-small" @click.stop="toggleDropdown(task.id)" title="Действия" aria-label="Действия">
                    <span class="icon"><i class="fas fa-ellipsis-v"></i></span>
                </button>
            </div>
            <div class="dropdown-menu" role="menu">
                <div class="dropdown-content">
                    <a :href="`/tasks/${task.slug}`" class="dropdown-item" title="Посмотреть" aria-label="Посмотреть"><i class="fas fa-eye"></i> Посмотреть</a>
                    <a :href="`/tasks/update/${task.slug}/`" class="dropdown-item" title="Редактировать" aria-label="Редактировать"><i class="fas fa-edit"></i> Редактировать</a>
                    <a href="#" class="dropdown-item has-text-danger" @click.prevent="openDeleteModal(task)" title="Удалить" aria-label="Удалить"><i class="fas fa-trash"></i> Удалить</a>
                </div>
            </div>
        </div>
    </div>
</div> 