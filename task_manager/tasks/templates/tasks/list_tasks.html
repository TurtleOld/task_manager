{% extends '../base.html' %}
{% load bootstrap4 %}


{% load i18n %}

{% block content %}
    <title>{% translate 'Список задач' %}</title>
    <h1 class="my-4">{% translate 'Задачи' %}</h1>
    <div class="card mb-3">
        <div class="card-body bg-light">
            <form method="get" class="form-inline justify-content-around">
                {% csrf_token %}
                {% bootstrap_form filter.form form_group_class='form-group' field_class='ml-2 mr-3' %}
                {% bootstrap_button button_filter_text button_type='submit' button_class='btn btn-outline-primary' %}
            </form>
        </div>
    </div>
    <a class="btn btn-outline-primary mb-1" href="{% url 'tasks:create' %}">{% translate 'Создать задачу' %}</a>
    <table class="bg-white mt-1 border table table-striped">
        <tr>
            <th scope="col">ID</th>
            <th scope="col">{% translate 'Имя' %}</th>
            <th scope="col">{% translate 'Статус' %}</th>
            <th scope="col">{% translate 'Напоминание до' %}</th>
            <th scope="col">{% translate 'Автор' %}</th>
            <th scope="col">{% translate 'Исполнитель' %}</th>
            <th scope="col">{% translate 'Дата создания' %}</th>
            <th scope="col">{% translate 'Крайний срок' %}</th>
            <th scope="col"></th>
        </tr>
        {% for task in tasks %}
        <tr>
            <td class="">{{ task.id }}</td>
            <td class="border p-2"><a class="text-decoration-none" href="{% url 'tasks:view_task' task.id %}">{{ task.name }}</a></td>
            <td class="border p-2">{{ task.status }}</td>
            <td class="border p-2 text-center">{% for period in task.reminder_periods.all %} {{ period }}{% if not forloop.last %}, {% endif %} {% endfor %}</td>
            <td class="border p-2">{{ task.author }}</td>
            <td class="border p-2">{{ task.executor }}</td>
            <td class="border p-2">{{ task.created_at|date:"d.m.Y H:i" }}</td>
            <td class="border p-2
                       {% if task.deadline %}
                            {% if task.is_deadline_overdue %}text-danger{% endif %}
                        {% else %}text-success
                        {% endif %}">{% if task.deadline %}{{ task.deadline|date:"d.m.Y H:i" }}{% else %} Бессрочно{% endif %}</td>
            <td class="d-flex justify-content-around">
                <a class="btn btn-outline-warning {% if task.state %}disabled{% endif %}"  href="{% url 'tasks:update_task' task.id %}">{% translate 'Изменить' %}</a>
                {% if task.state %}
                    <form action="{% url 'tasks:close_task' task.id %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-outline-success {% if task.state and task.author != user %}disabled{% endif %}">{% translate 'Переоткрыть' %}</button>
                    </form>
                {% else %}
                    <form action="{% url 'tasks:close_task' task.id %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-outline-dark">{% translate 'Закрыть' %}</button>
                    </form>
                {% endif %}
                <a class="btn btn-outline-danger" href="{% url 'tasks:delete_task' task.id %}">{% translate 'Удалить' %}</a>
            </td>
        </tr>
        {% endfor %}
    </table>
{% endblock %}